{"version":3,"file":"firebase-backend.esm.js","sources":["../src/models.ts","../src/functionParser.ts"],"sourcesContent":["// models.ts\n\n/**\n * @export\n * @enum {number}\n */\nexport enum RequestType {\n  GET = 'GET',\n  POST = 'POST',\n  PUT = 'PUT',\n  DELETE = 'DELETE',\n  PATCH = 'PATCH',\n}\n\n/**\n * @export\n * @interface IExpressHandler\n */\nexport interface IExpressHandler {\n  (req: any, res: any): any;\n}\n\n/**\n * @export\n * @interface IExpressMiddleware\n */\nexport interface IExpressMiddleware {\n  (req: any, res: any, next: any): any;\n}\n\n/**\n * @export\n * @interface ParserOptions\n */\nexport interface ParserOptions {\n  enableCors?: boolean;\n  buildReactive?: boolean;\n  buildEndpoints?: boolean;\n  groupByFolder?: boolean;\n  regional?: string;\n}\n\n/**\n * @export\n * @interface EndpointOptions\n */\nexport interface EndpointOptions {\n  enableCors?: boolean;\n  enableFileUpload?: boolean;\n}\n\n/**\n * Stores the information to be used when creating a restful endpoint on the backend\n *\n * @export\n * @class Endpoint\n */\nexport class Endpoint {\n  /**\n   * Creates an instance of Endpoint.\n   *\n   * @param {string} name\n   * @param {RequestType} requestType\n   * @param {IExpressHandler} handler\n   * @param {EndpointOptions} options\n   * @memberof Endpoint\n   */\n  constructor(\n    /**\n     * @deprecated \"name\" parameter is no longer needed\n     */\n    public name: string | undefined,\n    public requestType: RequestType,\n    public handler: IExpressHandler,\n    public middleware?: IExpressMiddleware[] | undefined,\n    public options?: EndpointOptions,\n  ) {\n    if (!handler) {\n      throw new Error('Please provide a endpoint request handler.');\n    }\n\n    this.name = name;\n    this.handler = handler;\n    this.middleware = middleware;\n    this.requestType = requestType;\n    this.options = options;\n  }\n}\n\nexport class Get extends Endpoint {\n  constructor(handler: IExpressHandler, middleware?: IExpressMiddleware[], options?: EndpointOptions) {\n    super(undefined, RequestType.GET, handler, middleware, options);\n  }\n}\n\nexport class Post extends Endpoint {\n  constructor(handler: IExpressHandler, middleware?: IExpressMiddleware[], options?: EndpointOptions) {\n    super(undefined, RequestType.POST, handler, middleware, options);\n  }\n}\nexport class Put extends Endpoint {\n  constructor(handler: IExpressHandler, middleware?: IExpressMiddleware[], options?: EndpointOptions) {\n    super(undefined, RequestType.PUT, handler, middleware, options);\n  }\n}\nexport class Delete extends Endpoint {\n  constructor(handler: IExpressHandler, middleware?: IExpressMiddleware[], options?: EndpointOptions) {\n    super(undefined, RequestType.DELETE, handler, middleware, options);\n  }\n}\nexport class Patch extends Endpoint {\n  constructor(handler: IExpressHandler, middleware?: IExpressMiddleware[], options?: EndpointOptions) {\n    super(undefined, RequestType.PATCH, handler, middleware, options);\n  }\n}\n","// functionParser.ts\n\nimport express, { Application, Router } from 'express';\nimport fileUpload from 'express-fileupload';\nimport * as functions from 'firebase-functions';\nimport glob from 'glob';\nimport cors from 'cors';\nimport { parse, ParsedPath } from 'path';\nimport { Endpoint, ParserOptions, RequestType } from './models';\n\n// enable short hand for console.log()\nconst { log } = console;\n\n/**\n * This class helps with setting sup the exports for the cloud functions deployment.\n *\n * It takes in exports and then adds the required groups and their functions to it for deployment\n * to the cloud functions server.\n *\n * @export\n * @class FunctionParser\n */\nexport class FunctionParser {\n  rootPath: string;\n\n  enableCors: boolean;\n\n  exports: any;\n\n  /**\n   * Creates an instance of FunctionParser.\n   *\n   * @param {string} rootPath\n   * @param {*} exports\n   * @param {ParserOptions} [options]\n   * @memberof FunctionParser\n   */\n  constructor(\n    rootPath: string,\n    exports: any,\n    options?: ParserOptions\n  ) {\n    if (!rootPath) {\n      throw new Error('rootPath is required to find the functions.');\n    }\n\n    this.rootPath = rootPath;\n    this.exports = exports;\n\n    // Set default option values for if not provided\n    this.enableCors = options?.enableCors ?? false;\n    let groupByFolder: boolean = options?.groupByFolder ?? true;\n    let buildReactive: boolean = options?.buildReactive ?? true;\n    let buildEndpoints: boolean = options?.buildEndpoints ?? true;\n    let regional: string = options?.regional ?? '';\n\n    if (buildReactive) {\n      this.buildReactiveFunctions(groupByFolder);\n    }\n\n    if (buildEndpoints) {\n      this.buildRestfulApi(groupByFolder, regional);\n    }\n  }\n\n  /**\n   * Looks for all files with .function.js and exports them on the group they belong to\n   *\n   * @private\n   * @param {boolean} groupByFolder\n   * @memberof FunctionParser\n   */\n  private buildReactiveFunctions(groupByFolder: boolean) {\n    log('Reactive Functions - Building...');\n\n    // Get all the files that has .function in the file name\n    const functionFiles: string[] = glob.sync(\n      `${this.rootPath}/**/*.function.js`,\n      {\n        cwd: this.rootPath,\n        ignore: './node_modules/**',\n      },\n    );\n\n    functionFiles.forEach((file: string) => {\n      const filePath: ParsedPath = parse(file);\n\n      const directories: string[] = filePath.dir.split('/');\n\n      const groupName: string = groupByFolder\n        ? directories[directories.length - 2] || ''\n        : directories[directories.length - 1] || '';\n\n      const functionName = filePath.name.replace('.function', '');\n\n      if (\n        !process.env.FUNCTION_NAME ||\n        process.env.FUNCTION_NAME === functionName\n      ) {\n        if (!this.exports[groupName]) this.exports[groupName] = {};\n        log(`Reactive Functions - Added ${groupName}/${functionName}`);\n\n        this.exports[groupName] = {\n          ...this.exports[groupName],\n          ...require(file),\n        };\n      }\n    });\n\n    log('Reactive Functions - Built');\n  }\n\n  /**\n   * Looks at all .endpoint.js files and adds them to the group they belong in\n   *\n   * @private\n   * @param {boolean} groupByFolder\n   * @memberof FunctionParser\n   */\n  private buildRestfulApi(groupByFolder: boolean, regional: string) {\n    log('Restful Endpoints - Building...');\n\n    const apiFiles: string[] = glob.sync(`${this.rootPath}/**/*.endpoint.js`, {\n      cwd: this.rootPath,\n      ignore: './node_modules/**',\n    });\n\n    const app: Application = express();\n\n    const groupRouters: Map<string, express.Router> = new Map();\n\n    apiFiles.forEach((file: string) => {\n      const filePath: ParsedPath = parse(file);\n\n      const directories: Array<string> = filePath.dir.split('/');\n\n      const groupName: string = groupByFolder\n        ? directories[directories.length - 2] || ''\n        : directories[directories.length - 1] || '';\n\n      let router: Router | undefined = groupRouters.get(groupName);\n\n      if (!router) {\n        router = express.Router();\n\n        groupRouters.set(groupName, router);\n      }\n\n      try {\n        this.buildEndpoint(file, groupName, router);\n      } catch (e) {\n        throw new Error(\n          `Restful Endpoints - Failed to add the endpoint defined in ${file} to the ${groupName} Api.`,\n        );\n      }\n\n      app.use('/', router);\n\n      this.exports[groupName] = {\n        ...this.exports[groupName],\n\n        api: regional == '' ? functions.https.onRequest(app) : functions.region(`${regional}`).https.onRequest(app),\n      };\n    });\n\n    log('Restful Endpoints - Built');\n  }\n\n  /**\n   * Parses a .endpoint.js file and sets the endpoint path on the provided router\n   *\n   * @private\n   * @param {string} file\n   * @param {express.Router} router\n   * @memberof FunctionParser\n   */\n  private buildEndpoint(\n    file: string,\n    groupName: string,\n    router: express.Router,\n  ) {\n    const filePath: ParsedPath = parse(file);\n\n    const endpoint: Endpoint = require(file).default as Endpoint;\n\n    const name: string =\n      endpoint.name || filePath.name.replace('.endpoint', '');\n\n    const { handler } = endpoint;\n\n    const { middleware } = endpoint;\n\n\n    // Enable cors if it is enabled globally else only enable it for a particular route\n    if (this.enableCors) {\n      router.use(cors());\n    }\n    else if (endpoint.options?.enableCors) {\n      log(`Cors enabled for ${name}`);\n      router.use(cors());\n    }\n\n    if (endpoint.options?.enableFileUpload) {\n      log(`File upload enabled for ${name}`);\n      router.use(fileUpload());\n    }\n\n    switch (endpoint.requestType) {\n      case RequestType.GET:\n        if (middleware) {\n          const mw = middleware;\n          router.get(`/${name}`, mw, handler);\n          break;\n        }\n        router.get(`/${name}`, handler);\n        break;\n\n      case RequestType.POST:\n        if (middleware) {\n          const mw = middleware;\n          router.post(`/${name}`, mw, handler);\n          break;\n        }\n        router.post(`/${name}`, handler);\n        break;\n\n      case RequestType.PUT:\n        if (middleware) {\n          const mw = middleware;\n          router.put(`/${name}`, mw, handler);\n          break;\n        }\n        router.put(`/${name}`, handler);\n        break;\n\n      case RequestType.DELETE:\n        if (middleware) {\n          const mw = middleware;\n          router.delete(`/${name}`, mw, handler);\n          break;\n        }\n        router.delete(`/${name}`, handler);\n        break;\n\n      case RequestType.PATCH:\n        if (middleware) {\n          const mw = middleware;\n          router.patch(`/${name}`, mw, handler);\n          break;\n        }\n        router.patch(`/${name}`, handler);\n        break;\n\n      default:\n        throw new Error(\n          `A unsupported RequestType was defined for a Endpoint.\\n\n          Please make sure that the Endpoint file exports a RequestType\n          using the constants in src/system/constants/requests.ts.\\n\n          **This value is required to add the Endpoint to the API**`,\n        );\n    }\n    log(\n      `Restful Endpoints - Added ${groupName}/${endpoint.requestType}:${name}`,\n    );\n  }\n}\n"],"names":["RequestType","Endpoint","name","requestType","handler","middleware","options","Error","Get","undefined","GET","Post","POST","Put","PUT","Delete","DELETE","Patch","PATCH","console","log","FunctionParser","rootPath","exports","enableCors","groupByFolder","buildReactive","buildEndpoints","regional","buildReactiveFunctions","buildRestfulApi","functionFiles","glob","sync","cwd","ignore","forEach","file","filePath","parse","directories","dir","split","groupName","length","functionName","replace","process","env","FUNCTION_NAME","require","apiFiles","app","express","groupRouters","Map","router","get","Router","set","buildEndpoint","e","use","api","functions","onRequest","https","endpoint","cors","enableFileUpload","fileUpload","mw","post","put","patch"],"mappings":"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"}