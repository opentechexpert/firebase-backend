"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t,r=e(require("express")),n=e(require("express-fileupload")),o=require("firebase-functions"),s=e(require("glob")),i=e(require("cors")),u=require("path");function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function a(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,(Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}(t=exports.RequestType||(exports.RequestType={})).GET="GET",t.POST="POST",t.PUT="PUT",t.DELETE="DELETE",t.PATCH="PATCH";var l=function(e,t,r,n,o){if(this.name=e,this.requestType=t,this.handler=r,this.middleware=n,this.options=o,!r)throw new Error("Please provide a endpoint request handler.");this.name=e,this.handler=r,this.middleware=n,this.requestType=t,this.options=o},d=function(e){function t(t,r,n){return e.call(this,void 0,exports.RequestType.GET,t,r,n)||this}return a(t,e),t}(l),c=function(e){function t(t,r,n){return e.call(this,void 0,exports.RequestType.POST,t,r,n)||this}return a(t,e),t}(l),h=function(e){function t(t,r,n){return e.call(this,void 0,exports.RequestType.PUT,t,r,n)||this}return a(t,e),t}(l),f=function(e){function t(t,r,n){return e.call(this,void 0,exports.RequestType.DELETE,t,r,n)||this}return a(t,e),t}(l),T=function(e){function t(t,r,n){return e.call(this,void 0,exports.RequestType.PATCH,t,r,n)||this}return a(t,e),t}(l),v=console.log,E=function(){function e(e,t,r){var n,o,s,i,u;if(!e)throw new Error("rootPath is required to find the functions.");this.rootPath=e,this.exports=t,this.enableCors=null!=(n=null==r?void 0:r.enableCors)&&n;var p=null==(o=null==r?void 0:r.groupByFolder)||o,a=null==(s=null==r?void 0:r.buildReactive)||s,l=null==(i=null==r?void 0:r.buildEndpoints)||i,d=null!=(u=null==r?void 0:r.regional)?u:"";a&&this.buildReactiveFunctions(p),l&&this.buildRestfulApi(p,d)}var t=e.prototype;return t.buildReactiveFunctions=function(e){var t=this;v("Reactive Functions - Building..."),s.sync(this.rootPath+"/**/*.function.js",{cwd:this.rootPath,ignore:"./node_modules/**"}).forEach((function(r){var n=u.parse(r),o=n.dir.split("/"),s=e?o[o.length-2]||"":o[o.length-1]||"",i=n.name.replace(".function","");process.env.FUNCTION_NAME&&process.env.FUNCTION_NAME!==i||(t.exports[s]||(t.exports[s]={}),v("Reactive Functions - Added "+s+"/"+i),t.exports[s]=p({},t.exports[s],require(r)))})),v("Reactive Functions - Built")},t.buildRestfulApi=function(e,t){var n=this;v("Restful Endpoints - Building...");var i=s.sync(this.rootPath+"/**/*.endpoint.js",{cwd:this.rootPath,ignore:"./node_modules/**"}),a=r(),l=new Map;i.forEach((function(s){var i=u.parse(s).dir.split("/"),d=e?i[i.length-2]||"":i[i.length-1]||"",c=l.get(d);c||(c=r.Router(),l.set(d,c));try{n.buildEndpoint(s,d,c)}catch(e){throw new Error("Restful Endpoints - Failed to add the endpoint defined in "+s+" to the "+d+" Api.")}a.use("/",c),n.exports[d]=p({},n.exports[d],{api:""==t?o.https.onRequest(a):o.region(""+t).https.onRequest(a)})})),v("Restful Endpoints - Built")},t.buildEndpoint=function(e,t,r){var o,s,p=u.parse(e),a=require(e).default,l=a.name||p.name.replace(".endpoint",""),d=a.handler,c=a.middleware;switch(this.enableCors?r.use(i()):null!=(o=a.options)&&o.enableCors&&(v("Cors enabled for "+l),r.use(i())),null!=(s=a.options)&&s.enableFileUpload&&(v("File upload enabled for "+l),r.use(n())),a.requestType){case exports.RequestType.GET:if(c){r.get("/"+l,c,d);break}r.get("/"+l,d);break;case exports.RequestType.POST:if(c){r.post("/"+l,c,d);break}r.post("/"+l,d);break;case exports.RequestType.PUT:if(c){r.put("/"+l,c,d);break}r.put("/"+l,d);break;case exports.RequestType.DELETE:if(c){r.delete("/"+l,c,d);break}r.delete("/"+l,d);break;case exports.RequestType.PATCH:if(c){r.patch("/"+l,c,d);break}r.patch("/"+l,d);break;default:throw new Error("A unsupported RequestType was defined for a Endpoint.\n\n          Please make sure that the Endpoint file exports a RequestType\n          using the constants in src/system/constants/requests.ts.\n\n          **This value is required to add the Endpoint to the API**")}v("Restful Endpoints - Added "+t+"/"+a.requestType+":"+l)},e}();exports.Delete=f,exports.Endpoint=l,exports.FunctionParser=E,exports.Get=d,exports.Patch=T,exports.Post=c,exports.Put=h;
//# sourceMappingURL=firebase-backend.cjs.production.min.js.map
